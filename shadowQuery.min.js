export class ShadowQuery extends Array{constructor(e,t){let o;if(Array.isArray(e))o=e;else if(e instanceof ShadowQuery)o=e;else if(e instanceof NodeList||e instanceof HTMLCollection){o=[];for(var r=0;r<e.length;r++)o.push(e[r])}else o=[shadow(e)];t&&(o=find(o,t)),super(...o)}addClass(e){for(let t of this)t.classList.add(e);return this}after(e){for(let t of this)t===t.parentNode.lastChild?toNodes(t,e,e=>t.appendChild(e)):toNodes(t,e,e=>t.parentNode.insertBefore(e,t.nextSibling));return this}append(e){for(let t of this)toNodes(t,e,e=>t.appendChild(e));return this}attr(e,t){if(1===arguments.length)return this[0]&&this[0].getAttribute(e);if(void 0===t||!1===t)for(let t of this)t.removeAttribute(e);else{"string"!=typeof t&&(t=JSON.stringify(t));for(let o of this)o.setAttribute(e,t)}return this}before(e){for(let t of this)toNodes(t,e,e=>t.parentNode.insertBefore(e,t));return this}hasClass(e){for(let t of this)if(t.classList.contains(e))return!0}off(e,t){for(let o of this)/^attr:/.test(e)||o.removeEventListener(e,t);return this}on(e,t){for(let o of this)/^attr:/.test(e)?new MutationObserver(t).observe(o,{attributes:!0,attributeFilter:[e.replace(/^attr:/,"")]}):o.addEventListener(e,t);return this}once(e,t){for(let o of this)/^attr:/.test(e)?onceObserver(o,e,t):onceListener(o,e,t);return this}prepend(e){for(let t of this)t===t.parentNode.lastChild?toNodes(t,e,e=>t.appendChild(e)):toNodes(t,e,e=>t.parentNode.insertBefore(e,t.firstChild));return this}prop(e,t){if(1===arguments.length)return this[0][e];if(void 0===t||!1===t)for(let t of this)delete t[e];else for(let o of this)o[e]=t;return this}query(e){return new ShadowQuery(find(this,e))}removeClass(e){for(let t of this)t.classList.remove(e);return this}text(e){if(!arguments.length)return this[0]&&this[0].childNodes[0]&&this[0].childNodes[0].nodeValue;for(let t of this)t.childNodes[0]&&(t.childNodes[0].nodeValue=e);return this}toggleClass(e,t){if(1===arguments.length)for(let t of this)t.classList.toggle(e);else for(let o of this)o.classList.toggle(e,t);return this}};export function shadowQuery(e,t){return new ShadowQuery(e,t)};export default shadowQuery;const $=shadowQuery;function toNodes(e,t,o){if(t instanceof Node)return o(t);if("function"==typeof t)return t(e,o);t instanceof Array||(t=new ShadowQuery(t));for(let e of t)o(e)}function find(e,t){const o=[];for(let r=0;r<e.length;r++)/^\s*:host\s*/.test(t)?o.push(e[r].host||e[r]):o.push(...e[r].querySelectorAll(t));return o}function onceListener(e,t,o){e.addEventListener(t,function r(...n){e.removeEventListener(t,r);o(...n)})}function onceObserver(e,t,o){const r=new MutationObserver(function(...e){r.disconnect(),o(...e)});r.observe(e,{attributes:!0,attributeFilter:[t.replace(/^attr:/,"")]})}function shadow(e){return e.shadowRoot||e}const templates={};function dynTemplate(e){const{array:t=[void 0],chunks:o,id:r="default",update:n}=e,s=e.template,i=`_shadowQueryChildArrayDynNode${r}`,l=`_shadowQueryChildArrayTimeout${r}`;return function(r,a){r[l]&&(clearTimeout(r[l]),delete r[l]),r[i]||(r[i]=[]);let f=r[i];if(e.hasOwnProperty("condition")&&!e.condition)return h(0);function h(e){for(let t=e;t<f.length;t++)for(let e=0;e<f[t].length;e++)r.removeChild(f[t][e]);f.splice(e)}function d(e){e>=t.length||(!o||e%o?u(e):r[l]=setTimeout(()=>u(e)))}function u(e){let o=r[i][e];if(!o){const e=$.template(s);o=$(e.children),a(e),r[i].push(o)}n&&n($(o),t[e],e),delete r[l],d(++e)}f.length>t.length&&h(t.length),d(0)}}shadowQuery.template=function(e){if("string"==typeof e){if(templates[e])return templates[e].content.cloneNode(!0);const t=document.createElement("template");return t.innerHTML=e,templates[e]=t,t.content.cloneNode(!0)}return dynTemplate(e)},shadowQuery.shadow=function(e,t,o={mode:"open"}){e.attachShadow(o).appendChild($.template(t))},shadowQuery.changed=function(e,t){let o=!1;e._shadowQueryChanges||(e._shadowQueryChanges={});for(let r of Object.keys(t)){const n=JSON.stringify(t[r]);n!==e._shadowQueryChanges[r]&&(e._shadowQueryChanges[r]=n,o=!0)}return o},shadowQuery.noSelf=function(e){let t;return function(){t||(t=!0,e(),t=!1)}},shadowQuery.properties=function(e,t){for(let o of Object.keys(t))if(e.hasOwnProperty(o)){const t=e[o];delete e[o],e[o]=t}else{const r=t[o];"function"==typeof r?e[o]=r():void 0!==r&&(e[o]=r)}};
