/* eslint-disable */
export class ShadowQuery extends Array{constructor(e,t){if(0===e)return super(0);let r;r=Array.isArray(e)?e:"string"==typeof e?[shadowQuery.template(e)]:e instanceof ShadowQuery?e:e instanceof NodeList||e instanceof HTMLCollection?Array.from(e):[e.shadowRoot||e],t&&(r=find(r,t)),super(...r)}addClass(e){for(let t of this)t.classList.add(e);return this}after(e){for(let t of this)t===t.parentNode.lastChild?toNodes(t,e,e=>t.parentNode.appendChild(e)):toNodes(t,e,e=>t.parentNode.insertBefore(e,t.nextSibling));return this}append(e){for(let t of this)toNodes(t,e,e=>t.appendChild(e));return this}attr(e,t){if(1===arguments.length)return this[0]&&this[0].getAttribute(e);if(void 0===t||!1===t)for(let t of this)t.removeAttribute(e);else{"string"!=typeof t&&(t=JSON.stringify(t));for(let r of this)r.setAttribute(e,t)}return this}before(e){for(let t of this)toNodes(t,e,e=>t.parentNode.insertBefore(e,t));return this}hasClass(e){for(let t of this)if(t.classList.contains(e))return!0;return!1}off(e,t){for(let r of this)if(/^attr:/.test(e))try{r[obsKey(attrFilter(e))][t].disconnect()}catch(e){}else if(/^prop:/.test(e))offProp(r,e,t);else if(/^text:/.test(e))try{r[obsKey(textFilter())][t].disconnect()}catch(e){}else r.removeEventListener(e,t._shadowQueryNoSelf||t);return this}on(e,t,r){const o=3===arguments.length&&"noSelf"===t;2===arguments.length&&(r=t);for(let t of this)/^text:$/.test(e)?observer(t,o,r,textFilter()):/^attr:/.test(e)?observer(t,o,r,attrFilter(e)):/^prop:/.test(e)?onProp(t,e,o,r):t.addEventListener(e,o?noSelf(r):r);return this}once(e,t){for(let r of this)/^text:$/.test(e)?onceObserver(r,t,textFilter()):/^attr:/.test(e)?onceObserver(r,t,attrFilter(e)):/^prop:/.test(e)?onceProp(r,e,t):r.addEventListener(e,t,{once:!0});return this}prepend(e){for(let t of this)t.firstChild?toNodes(t,e,e=>t.insertBefore(e,t.firstChild)):toNodes(t,e,e=>t.appendChild(e));return this}prop(e,t){if(1===arguments.length)return this[0][e];for(let r of this)r[e]=t;return this}query(e){return new ShadowQuery(find(this,e))}removeClass(e){for(let t of this)t.classList.remove(e);return this}shadow(e,t={mode:"open"}){for(let r of this){const o=r.attachShadow(t);e&&o.appendChild($.template(e))}return this}text(e){if(!arguments.length)return this[0]&&this[0].childNodes[0]&&this[0].childNodes[0].nodeValue;for(let t of this)t.childNodes[0]&&(t.childNodes[0].nodeValue=e);return this}toggleClass(e,t){if(1===arguments.length)for(let t of this)t.classList.toggle(e);else{t=!!t;for(let r of this)r.classList.toggle(e,t)}return this}};export function shadowQuery(e,t){return new ShadowQuery(e,t)};export default shadowQuery;const $=shadowQuery;function toNodes(e,t,r){if(t instanceof Node)return r(t);if(t.constructor===Object&&(t=shadowQuery.template(t)),"function"==typeof t)return"processDynNodes"==t.name?t(e,r):r(t());t instanceof Array||(t=new ShadowQuery(t));for(let e of t)r(e)}function find(e,t){const r=[];for(let o=0;o<e.length;o++)if(/:host/.test(t))for(let n of t.split(","))if(/^\s*:host\s*/.test(n)){n=n.replace(/^\s*:host\s*/,"");const t=e[o].host||e[o];/[^\s]/.test(n)?r.push(...t.querySelectorAll(n)):r.push(t)}else r.push(...e[o].querySelectorAll(n));else r.push(...e[o].querySelectorAll(t));return r}function attrFilter(e){return{attributes:!0,attributeFilter:[e.replace(/^attr:/,"")]}}function textFilter(){return{characterData:!0,subtree:!0}}function onceObserver(e,t,r){const o=observer(e,!1,function(...e){o.disconnect(),t(...e)},r,t)}function observer(e,t,r,o,n=r){const s=new MutationObserver(t?noSelf(r,!0):r);return s.observe(e,o),e[obsKey(o)]?e[obsKey(o)][n]=s:e[obsKey(o)]={[n]:s},s}function obsKey(e){return`_shadowQueryObserver${JSON.stringify(e)}`}function offProp(e,t,r){if(!e[propKey(t)])return;const o=e[propKey(t)].listener;if(o.splice(o.indexOf(r._shadowQueryNoSelf||r),1),o.length)return;const n=e[propKey(t)].value;delete e[propKey(t)];const s=t.replace(/^prop:/,"");delete e[s],e[s]=n}function onceProp(e,t,r){onProp(e,t,!1,function _onceListener(...o){offProp(e,t,_onceListener);r(...o)})}function onProp(e,t,r,o){const n=propKey(t);e[n]||(e[n]={listener:[]}),e[n].listener.push(r?noSelf(o):o);const s=t.replace(/^prop:/,"");e.hasOwnProperty(s)&&(e[n].value=e[s],delete e[s]),Object.defineProperty(e,s,{get:function(){return e[n].value},set:function(r){return e[n].value=r,tell(e,e[n],t),r},enumerable:!0,configurable:!0})}function propKey(e){return`_shadowQueryProp${e}`}function tell(e,t,r){for(let o of t.listener)o(t.value,e,r)}function noSelf(e,t){let r;return e._shadowQueryNoSelf=function(){r||(r=!0,e(),t?setTimeout(function(){r=!1}):r=!1)}}const templates={};function dynTemplate(e){const{array:t=[void 0],chunks:r,id:o="default",update:n}=e,s=e.template,i=`_shadowQueryChildArrayDynNode${o}`,l=`_shadowQueryChildArrayTimeout${o}`;return function processDynNodes(o,f){o[l]&&(clearTimeout(o[l]),delete o[l]),o[i]||(o[i]=[]);let u=o[i];if(e.hasOwnProperty("condition")&&!e.condition)return removeNodes(0);function removeNodes(e){for(let t=e;t<u.length;t++)for(let e=0;e<u[t].length;e++)o.removeChild(u[t][e]);u.splice(e)}function iterDynNodeChunk(n){n>=t.length?e.done&&e.done():!r||n%r?iterNodeArray(n):o[l]=setTimeout(()=>iterNodeArray(n))}function iterNodeArray(e){let r=o[i][e];if(!r){const e=$.template(s);r=$(e.children),f(e),o[i].push(r)}n&&n($(r),t[e],e),delete o[l],iterDynNodeChunk(++e)}u.length>t.length&&removeNodes(t.length),iterDynNodeChunk(0)}}shadowQuery.template=function(e){if("string"==typeof e){if(templates[e])return templates[e].content.cloneNode(!0);const t=document.createElement("template");return t.innerHTML=e,templates[e]=t,t.content.cloneNode(!0)}return dynTemplate(e)};
